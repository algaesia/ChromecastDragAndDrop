<html>
	<head>
		<link type="text/css" rel="stylesheet" href="stylesheet.css"></link>
		<title>PONG</title>
	</head>
	<body>
		<canvas id = "gameCanvas" width = "500" height = "500"></canvas>
		<script>
			var gameCanvas = document.getElementById("gameCanvas");
			var gameContext = gameCanvas.getContext("2d");
			
			var canvasWidth = 500;
			var canvasHeight = 500;
			
			gameCanvas.width = canvasWidth;
			gameCanvas.height = canvasHeight;
			
			document.addEventListener('keydown',function(event) {
				if (event.keyCode == 40) {
					player1.moveDown();
				}
				else if (event.keyCode == 38) {
					player1.moveUp();
				}
				
				if (event.keyCode == 83) {
					player2.moveDown();
				}
				else if (event.keyCode == 87) {
					player2.moveUp();
				}
			});
			
			var gLoop;
			
			var playerObject = function(x,y,width,height) {
				var currentContext = this;
				var maxVelo = 10;
				
				currentContext.Image = new Image();
				currentContext.Image.src = "paddle.jpg";
				
				currentContext.xPos = x;
				currentContext.yPos = y;
				
				currentContext.xVelo = 5;
				currentContext.yVelo = 5;
				
				currentContext.width = width;
				currentContext.height = height;
				
				currentContext.xAcc = 0.1;
				currentContext.yAcc = 0.1;
				
				currentContext.Score = 0;
				
				currentContext.Update = function() {
					if (currentContext.yPos < 1) {
						currentContext.yPos = 1
					}
					
					if (currentContext.yPos + currentContext.height > canvasHeight) {
						currentContext.yPos = canvasHeight - currentContext.height - 1;
					}
				}
				
				currentContext.moveUp = function() {					
					if (currentContext.yVelo > maxVelo) {
						currentContext.yVelo = maxVelo;
					}
					if (currentContext.yVelo < -maxVelo) {
						currentContext.yVelo = -maxVelo;
						currentContext.yVelo = -maxVelo;
					}
					currentContext.yVelo += currentContext.yAcc;
					currentContext.yPos -= currentContext.yVelo;
				}
				
				currentContext.moveDown = function() {
					if (currentContext.yVelo > maxVelo) {
						currentContext.yVelo = maxVelo;
					}
					if (currentContext.yVelo < -maxVelo) {
						currentContext.yVelo = -maxVelo;
						currentContext.yVelo = -maxVelo;
					}
					currentContext.yVelo += currentContext.yAcc;
					currentContext.yPos += currentContext.yVelo;
				}
				
				currentContext.Draw = function() {
					gameContext.drawImage(currentContext.Image,currentContext.xPos,
										  currentContext.yPos,currentContext.width,
										  currentContext.height);
				}
			};
			
			var player1 = new playerObject(50,200,32,64);
			var player2 = new playerObject(420,200,32,64);
			
			var ballObject = new (function() {
				var currentContext = this;
				
				var maxVelo = 3;
				
				currentContext.xPos = canvasWidth / 2;
				currentContext.yPos = canvasHeight / 2;
				
				currentContext.Radius = 5;
				
				currentContext.xVelo = 3;
				currentContext.yVelo = 1;
				
				currentContext.xAcc = 0.1;
				currentContext.yAcc = 0.1;
				
				currentContext.bHasCollided = false;
				
				currentContext.Update = function() {					
					currentContext.xVelo += currentContext.xAcc;
					currentContext.yVelo += currentContext.yAcc;
					
					if (currentContext.xVelo > maxVelo) {
						currentContext.xVelo = maxVelo;
					}
					
					if (currentContext.yVelo > maxVelo) {
						currentContext.yVelo = maxVelo;
					}
					
					if (currentContext.xVelo < -maxVelo) {
						currentContext.xVelo = -maxVelo;
					}
					
					if (currentContext.yVelo < -maxVelo) {
						currentContext.yVelo = -maxVelo;
						currentContext.yVelo = -maxVelo;
					}
					
					if (currentContext.xPos - currentContext.Radius < 0 || currentContext.xPos + currentContext.Radius > canvasWidth) {
						currentContext.xVelo = -currentContext.xVelo;
						currentContext.xAcc = -currentContext.xAcc;
					}
					
					if (currentContext.yPos - currentContext.Radius < 0 || currentContext.yPos + currentContext.Radius > canvasHeight) {
						currentContext.yVelo = -currentContext.yVelo;
						currentContext.yAcc = -currentContext.yAcc;
					}
					
					if (currentContext.bHasCollided) {		
						currentContext.xVelo = -currentContext.xVelo;
						currentContext.xAcc = -currentContext.xAcc;
						
						currentContext.bHasCollided = false;
					}
					
					currentContext.xPos += currentContext.xVelo;
					currentContext.yPos += currentContext.yVelo;
				}
				
				currentContext.Draw = function() {
					gameContext.beginPath();
					gameContext.arc(currentContext.xPos,currentContext.yPos,currentContext.Radius,0,Math.PI * 2, true);
					gameContext.stroke();
				}
			}) ();
			
			var getDistance = function(xPos1, yPos1, xPos2, yPos2) {
				var newXDist = xPos2 - xPos1;
				var newYDist = yPos2 - yPos1;
				
				return Math.sqrt(((newXDist * newXDist) + (newYDist * newYDist)));
			}
			
			var CheckCollision = function() {
				var player1CentreX = player1.xPos + (player1.width / 2);
				var player2CentreX = player2.xPos + (player2.width / 2);
				
				var player1CentreY = player1.yPos + (player1.height / 2);
				var player2CentreY = player2.yPos + (player2.height / 2);
				
				var distP1toBall = getDistance(player1CentreX,player1CentreY,ballObject.xPos,ballObject.yPos);
				var distP2toBall = getDistance(player2CentreX,player2CentreY,ballObject.xPos,ballObject.yPos);
				
				//left hand side
				if (ballObject.xPos - ballObject.Radius < player1.xPos + player1.width && ballObject.xPos - ballObject.Radius > player1.xPos) {
					if (ballObject.yPos < player1.yPos + player1.height && ballObject.yPos > player1.yPos) {
						if (distP1toBall < ballObject.Radius + player1.width) {
							ballObject.bHasCollided = true;
						}
					}
				}
				
				//right hand side
				if (ballObject.xPos + ballObject.Radius > player2.xPos && ballObject.xPos + ballObject.Radius < player2.xPos + player2.width) {
					if (ballObject.yPos < player2.yPos + player2.height && ballObject.yPos > player2.yPos) {
						if (distP2toBall < ballObject.Radius + player2.width) {
							ballObject.bHasCollided = true
						}
					}
				}
			}
			
			var ClearScreen = function() {
				gameContext.fillStyle = "White";
				gameContext.beginPath();
				gameContext.rect(0,0,canvasWidth,canvasHeight);
				gameContext.closePath();
				gameContext.fill();
				
				gameContext.fillStyle = "Black";
				gameContext.beginPath();
				gameContext.strokeRect(0,0,canvasWidth,canvasHeight);
				gameContext.fill();
			}
			
			var GameLoop = function() {
				ClearScreen();
				
				ballObject.Update();
				player1.Update();
				player2.Update();
				
				CheckCollision();
				
				player1.Draw();
				player2.Draw();
				ballObject.Draw();
				
				gLoop = setTimeout(GameLoop,1000/60);
			}
			GameLoop();
		</script>
	</body>
</html>